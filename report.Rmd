---
title: "Analysis Report"
output: html_notebook
---
```{r include=FALSE}
if(!require(kableExtra)) install.packages("kableExtra", repos="http://cran.us.r-project.org")
if(!require(ggplot2)) install.packages("ggplot2", repos="http://cran.us.r-project.org")
if(!require(tidyverse)) install.packages("tidyverse", repos="http://cran.us.r-project.org")
if(!require(gplots)) install.packages("gplots", repos="http://cran.us.r-project.org")
if (!requireNamespace("devtools", quietly = TRUE)){install.packages("devtools")}
devtools::install_github("jbisanz/qiime2R") # current version is 0.99.20
library(kableExtra)
library(ggplot2)
library(qiime2R)
```
This is a report generated to summarize the major results from the analysis. It is not intended to be a full picture, rather a jumping off point. This report will reference the files displayed in case you would like to examine them further.

### Cutoffs Calculated 
This table comes from cutoffs.csv
```{r}
cutoffs = read.csv("cutoffs.csv",sep = ',',strip.white = TRUE)
#cutoffs = knitr::kable(cutoffs)
cutoffs %>% kbl() %>% kable_styling(bootstrap_options = c("striped","condensed","responsive"))
```

### Dada 2 Stats
This table was constructed from data in the stats-dada2.qzv object
```{r}
dadastat = read.csv("dada2_stats.tsv",sep = '\t',strip.white = TRUE)
#dadastat_t = dadastat %>% kbl() %>% kable_classic(full_width = F)
dadastat %>% kbl() %>% kable_styling(bootstrap_options = c("striped","condensed","responsive")) 
```

### Sampling Depth
This table was constructed from data in sampling_depth.csv
```{r}
depth = read.csv("sampling_depth.csv", sep=",")
depth %>% kbl() %>% kable_styling(bootstrap_options = c("striped","condensed","responsive"))
```

### Alpha Diversity

## Eveneness
This data comes from the file evenness-group-significance.qzv
```{r}
evenness_vals = read.csv("./evenness/metadata.tsv", sep='\t')
evenness_vals %>% kbl() %>% kable_styling(bootstrap_options = c("striped","condensed","responsive"))
```

```{r}
evenness_stats = read.csv("./evenness/kruskal-wallis-pairwise-time.csv")

evenness_stats %>% kbl() %>% kable_styling(bootstrap_options = c("condensed","responsive"))
```
This diversity measurement is focused on highlighting _ in the dataset

## Faith
This data comes from the file faith-pd-group-significance.qzv.
```{r}
faith_vals = read.csv("./faith/metadata.tsv", sep='\t')
faith_vals %>% kbl() %>% kable_styling(bootstrap_options = c("striped","condensed","responsive"))
```
```{r}
faith_stats = read.csv("./faith/kruskal-wallis-pairwise-time.csv")
faith_stats %>% kbl() %>% kable_styling(bootstrap_options = c("condensed","responsive"))
```
This diversity measurement is focused on highlighting _ in the dataset

## Alpha Diversity Plot 

```{r}
dims = dim(evenness_vals)
evenness_vals <- data.frame(evenness_vals[2:dims[1],])
evenness_vals$time <- as.factor(evenness_vals$time)
evenness_vals$pielou_evenness <- as.numeric(as.character(evenness_vals$pielou_evenness))
boxplot(evenness_vals$pielou_evenness~evenness_vals$time, data=evenness_vals)

p <- ggplot(evenness_vals, aes(x=time, y=pielou_evenness)) + geom_violin()+ geom_boxplot(width=0.1)
p<- p + stat_summary(fun.y=mean, geom="point", shape=23, size=2)
p<-p + stat_summary(fun.y=median, geom="point", size=2, color="red")
p <- p+geom_jitter(shape=16, position=position_jitter(0.2))
p
```

### Beta diversity core-metrics-results/unweighted_unifrac_emperor.qzv 
note: time will need to be replaced with probably treatment or other feature of interest

Bray curtis ordination

```{r}
library(tidyverse)
library(qiime2R)
library(gplots)

metadata<-read_q2metadata("metadata.tsv")
jaccard <- read_qza("core-metrics-results/bray_curtis_pcoa_results.qza")
shannon<-read_qza("core-metrics-results/shannon_vector.qza")
shannon <- shannon$data %>% rownames_to_column("SampleID")


jaccard$data$Vectors %>%
  select(SampleID, PC1, PC2) %>%
  left_join(metadata) %>%
  left_join(shannon) %>%
  ggplot(aes(x=PC1, y=PC2, color=time, size=shannon_entropy))+
  geom_point(alpha=0.5) +
  theme_q2r() +
  scale_size_continuous(name="Shannon Diversity") +
  scale_color_discrete(name="Time")

```

Jaccard ordination

```{r}
library(tidyverse)
library(qiime2R)
library(gplots)

metadata<-read_q2metadata("metadata.tsv")
jaccard <- read_qza("core-metrics-results/jaccard_pcoa_results.qza")
shannon<-read_qza("core-metrics-results/shannon_vector.qza")
shannon <- shannon$data %>% rownames_to_column("SampleID")


jaccard$data$Vectors %>%
  select(SampleID, PC1, PC2) %>%
  left_join(metadata) %>%
  left_join(shannon) %>%
  ggplot(aes(x=PC1, y=PC2, color=time, size=shannon_entropy))+
  geom_point(alpha=0.5) +
  theme_q2r() +
  scale_size_continuous(name="Shannon Diversity") +
  scale_color_discrete(name="Time")

```

unweighted unifrac ordination

```{r}
library(tidyverse)
library(qiime2R)
library(gplots)

metadata<-read_q2metadata("metadata.tsv")
jaccard <- read_qza("core-metrics-results/unweighted_unifrac_pcoa_results.qza")
shannon<-read_qza("core-metrics-results/shannon_vector.qza")
shannon <- shannon$data %>% rownames_to_column("SampleID")


jaccard$data$Vectors %>%
  select(SampleID, PC1, PC2) %>%
  left_join(metadata) %>%
  left_join(shannon) %>%
  ggplot(aes(x=PC1, y=PC2, color=time, size=shannon_entropy))+
  geom_point(alpha=0.5) +
  theme_q2r() +
  scale_size_continuous(name="Shannon Diversity") +
  scale_color_discrete(name="Time")

```
weighted unifrac ordination

```{r}
library(tidyverse)
library(qiime2R)
library(gplots)

metadata<-read_q2metadata("metadata.tsv")
jaccard <- read_qza("core-metrics-results/weighted_unifrac_pcoa_results.qza")
shannon<-read_qza("core-metrics-results/shannon_vector.qza")
shannon <- shannon$data %>% rownames_to_column("SampleID")


jaccard$data$Vectors %>%
  select(SampleID, PC1, PC2) %>%
  left_join(metadata) %>%
  left_join(shannon) %>%
  ggplot(aes(x=PC1, y=PC2, color=time, size=shannon_entropy))+
  geom_point(alpha=0.5) +
  theme_q2r() +
  scale_size_continuous(name="Shannon Diversity") +
  scale_color_discrete(name="Time")

```
